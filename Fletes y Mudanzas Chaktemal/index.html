<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cotizador Mudanzas Chetumal</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; background:#f7f7f7; padding:20px; }
    .box { background:white; padding:20px; border-radius:10px; max-width:700px; margin:auto; box-shadow:0 4px 10px rgba(0,0,0,.2);}
    h2 { text-align:center; color:#007bff; }
    label { font-weight:bold; margin-top:10px; display:block; }
    input, select, textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:5px; }
    button { margin-top:15px; padding:12px; border:none; width:100%; border-radius:8px; font-weight:bold; cursor:pointer;}
    .btn-primary { background:#28a745; color:white; }
    .btn-whatsapp { background:#25D366; color:white; }
    .error { color:red; font-weight:bold; margin-top:10px; }
  </style>
</head>
<body>
  <div class="box">
    <h2>¬°Cotiza tu Mudanza!</h2>

    <label>Nombre</label>
    <input id="nombre">

    <label>Apellido</label>
    <input id="apellido">

    <label>Tel√©fono</label>
    <input id="telefono">

    <label>Ciudad/Colonia Origen</label>
    <input id="origen">

    <label>Ciudad/Colonia Destino</label>
    <input id="destino">

    <label>Fecha</label>
    <input type="date" id="fecha">

    <label>Hora</label>
    <input type="time" id="hora">

    <label>Lista de objetos</label>
    <textarea id="objetos" rows="3"></textarea>

    <p id="resultado"></p>
    <p class="error" id="error"></p>

    <button class="btn-primary" onclick="cotizar()">Calcular</button>
    <button class="btn-whatsapp" onclick="reservar()">Reservar por WhatsApp</button>
  </div>

<script>
  let agendas = JSON.parse(localStorage.getItem("agendas")) || [];

  // Objetos grandes
  const grandes = ["refrigerador","lavadora","sala","cama","ropero","tocador","tanque","estufa","tele"];

  function cotizar(){
    let objetosTexto = document.getElementById("objetos").value.toLowerCase();
    let lista = objetosTexto.split(",").map(x => x.trim()).filter(x => x.length>0);

    let grandesDetectados = grandes.filter(item => objetosTexto.includes(item));
    let precio = 0;
    let detalle = "";

    // Reglas de precios
    if(grandesDetectados.length > 1 || (grandesDetectados.length === 1 && lista.length > 1)){
      precio = 450;
      detalle = "Mudanza completa ($450). Se detectaron varios art√≠culos grandes.";
    } else if(grandesDetectados.length === 1 && lista.length === 1){
      precio = 150;
      detalle = "Mini-flete ($150). Solo 1 art√≠culo grande.";
    } else {
      if(lista.length <= 2) { precio = 150; detalle = "Mini-flete chico ($150)."; }
      else if(lista.length === 3) { precio = 300; detalle = "Mini-flete mediano ($300)."; }
      else { precio = 450; detalle = "Mudanza completa ($450). Por cantidad de art√≠culos."; }
    }

    document.getElementById("resultado").innerText = "Total: $" + precio + " ‚Üí " + detalle +
    "\nIncluye carga y descarga a pie de casa. Si requiere segunda vuelta, el precio se trata aparte.";
    return precio;
  }

  function reservar(){
    let nombre = document.getElementById("nombre").value;
    let apellido = document.getElementById("apellido").value;
    let telefono = document.getElementById("telefono").value;
    let origen = document.getElementById("origen").value;
    let destino = document.getElementById("destino").value;
    let fecha = document.getElementById("fecha").value;
    let hora = document.getElementById("hora").value;
    let objetos = document.getElementById("objetos").value;

    // Validar horarios con media hora de separaci√≥n
    let horaMinutos = convertirHora(hora);
    let ocupado = agendas.find(a => a.fecha === fecha && 
      Math.abs(convertirHora(a.hora) - horaMinutos) < 30);

    if(ocupado){
      document.getElementById("error").innerText = "‚ö†Ô∏è Ese horario est√° ocupado o demasiado cerca. Debe haber 30 min de diferencia.";
      return;
    }
    document.getElementById("error").innerText = "";

    let precio = cotizar();

    agendas.push({fecha,hora});
    localStorage.setItem("agendas", JSON.stringify(agendas));

    let mensaje = `Nueva cotizaci√≥n üöõ Mudanzas Chetumal\n\nCliente: ${nombre} ${apellido}\nTel: ${telefono}\nFecha: ${fecha}\nHora: ${hora}\nObjetos: ${objetos}\n\nPrecio: $${precio}\n\nOrigen: ${origen}\nDestino: ${destino}\n\nIncluye carga y descarga a pie de casa.\n‚ö†Ô∏è Nota: Este costo incluye personal para cargar y descargar sus pertenencias a pie de casa (se refiere a cochera o entrada) si requiere ayuda para acomodar sus pertenencias dentro de su domicilio(primer planta) o subir a un segundo piso ya es a propina para el personal. Si requiere segundas vueltas, el precio se negocia.`;

    let url = "https://wa.me/529833400341?text=" + encodeURIComponent(mensaje);
    window.open(url,"_blank");
  }

  function convertirHora(hora){
    let [h,m] = hora.split(":").map(Number);
    return h*60+m;
  }
</script>
</body>
</html>
